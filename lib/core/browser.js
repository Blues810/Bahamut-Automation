var c=Object.create;var i=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var n=t=>i(t,"__esModule",{value:!0});var b=(t,e)=>{for(var r in e)i(t,r,{get:e[r],enumerable:!0})},a=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of p(e))!m.call(t,s)&&(r||s!=="default")&&i(t,s,{get:()=>e[s],enumerable:!(o=u(e,s))||o.enumerable});return t},h=(t,e)=>a(n(i(t!=null?c(f(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),x=(t=>(e,r)=>t&&t.get(e)||(r=a(n({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var B={};b(B,{default:()=>d});var w=h(require("events")),g=h(require("playwright")),_=["chromium","firefox","webkit"],y={headless:!0,firefoxUserPrefs:{"dom.webaudio.enabled":!1,"media.volume_scale":0}},l=class extends w.default{constructor(e,r,o=null){super();this.browser_type=e;this.browser_config=r;this.logger=o;_.includes(e)||(e="firefox"),this.setup()}browser=null;context=null;user_agent="";info(...e){this.logger&&this.logger.info(...e)}async setup(){}async launch(){if(!this.browser){this.info("\u4F7F\u7528\u700F\u89BD\u5668",this.browser_type);let e=g.default[this.browser_type];this.browser=await e.launch({...y,...this.browser_config}),this.emit("launched",this.browser)}if(!this.context){let e=await this.browser.newPage();this.user_agent=(await e.evaluate(()=>navigator.userAgent)).replace("Headless","")+" BA/1",await e.close(),this.info("User-Agent:",this.user_agent),this.context=await this.browser.newContext({userAgent:this.user_agent}),this.emit("context_created",this.context)}return this}async close(){return this.browser&&(await this.browser.close(),this.browser=null,this.context=null,this.user_agent="",this.emit("closed")),this}async new_page(){if(!this.context)throw new Error("No Context.");let e=await this.context.newPage();return this.emit("new_page",e),e}},d=l;module.exports=x(B);0&&(module.exports={});
