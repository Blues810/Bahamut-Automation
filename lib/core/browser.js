/* minified */
"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const events_1=__importDefault(require("events")),playwright_1=__importDefault(require("playwright")),BRWOSER_TYPES=["chromium","firefox","webkit"],DEFAULT_BROWSER_CONFIG={headless:!0,firefoxUserPrefs:{"dom.webaudio.enabled":!1,"media.volume_scale":0}};class Browser extends events_1.default{browser_type;browser_config;logger;browser=null;context=null;user_agent="";constructor(e,t,s=null){super(),this.browser_type=e,this.browser_config=t,this.logger=s,BRWOSER_TYPES.includes(e)||(e="firefox"),this.setup()}info(...e){this.logger&&this.logger.info(...e)}async setup(){}async launch(){if(!this.browser){this.info("使用瀏覽器",this.browser_type);const e=playwright_1.default[this.browser_type];this.browser=await e.launch({...DEFAULT_BROWSER_CONFIG,...this.browser_config}),this.emit("launched",this.browser)}if(!this.context){const t=await this.browser.newPage();this.user_agent=(await t.evaluate(()=>navigator.userAgent)).replace("Headless","")+" BA/1",await t.close(),this.info("User-Agent:",this.user_agent),this.context=await this.browser.newContext({userAgent:this.user_agent}),this.emit("context_created",this.context)}return this}async close(){return this.browser&&(await this.browser.close(),this.browser=null,this.context=null,this.user_agent="",this.emit("closed")),this}async new_page(){if(!this.context)throw new Error("No Context.");var e=await this.context.newPage();return this.emit("new_page",e),e}}exports.default=Browser;