var s=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var P=t=>s(t,"__esModule",{value:!0});var I=(t,e)=>{for(var r in e)s(t,r,{get:e[r],enumerable:!0})},F=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of f(e))!h.call(t,a)&&(r||a!=="default")&&s(t,a,{get:()=>e[a],enumerable:!(o=y(e,a))||o.enumerable});return t};var v=(t=>(e,r)=>t&&t.get(e)||(r=F(P({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var b={};I(b,{default:()=>M});var g=require("otplib");var u=class{parameters=[];run({page:e,outputs:r,params:o,logger:a}){throw new Error("Module not implemented.")}};var w=new u;w.parameters=[{name:"username",required:!0},{name:"password",required:!0},{name:"twofa",required:!1},{name:"login_max_attempts",required:!1}];w.run=async({page:t,params:e,logger:r})=>{let o=(...i)=>r.log("\x1B[95m[\u767B\u5165]\x1B[m",...i),a=(...i)=>r.error("\x1B[95m[\u767B\u5165]\x1B[m",...i),c=!1;o("\u958B\u59CB\u57F7\u884C\u5E33\u865F\u767B\u5165\u7A0B\u5E8F"),await t.goto("https://www.gamer.com.tw/").catch(a),await t.waitForTimeout(1e3);let p=+e.login_max_attempts||3;for(let i=0;i<p;i++)try{if(o("\u6B63\u5728\u6AA2\u6E2C\u767B\u5165\u72C0\u614B"),await t.goto("https://www.gamer.com.tw/"),await t.waitForSelector("#topBar_more"),await t.waitForTimeout(100),await t.$("div.TOP-my.TOP-nologin")){if(o("\u767B\u5165\u72C0\u614B: \u672A\u767B\u5165"),await t.goto("https://user.gamer.com.tw/login.php").catch(a),o("\u5617\u8A66\u767B\u5165\u4E2D"),!e.username||!e.password)throw new Error("\u5E33\u865F\u6216\u5BC6\u78BC\u4E0D\u80FD\u70BA\u7A7A");await t.$eval("input.form-control[type=text]",n=>n.value="").catch(a),await t.$eval("input.form-control[type=password]",n=>n.value="").catch(a),await t.type("input.form-control[type=text]",e.username,{delay:101}).catch(a),await t.waitForTimeout(500),await t.type("input.form-control[type=password]",e.password,{delay:101}).catch(a),await t.waitForTimeout(1e3),await x(t,e,a,o),await t.waitForTimeout(500);let m=await t.$("iframe[title='reCAPTCHA']");if(m){o("Recaptcha Found."),await m.waitForSelector(".rc-anchor-center-item.rc-anchor-checkbox-holder");let n=await m.$(".rc-anchor-center-item.rc-anchor-checkbox-holder");n&&(o(n),await n.click().catch(a),await t.waitForTimeout(2e3))}await t.click("a#btn-login").catch(a),await t.waitForTimeout(3e3),i>0&&o("\u5DF2\u5617\u8A66\u767B\u5165\uFF0C\u91CD\u65B0\u6AA2\u6E2C\u767B\u5165\u72C0\u614B")}else{o("\u767B\u5165\u72C0\u614B: \u5DF2\u767B\u5165"),c=!0;break}}catch(l){a(l),a("\u767B\u5165\u6642\u767C\u751F\u932F\u8AA4\uFF0C\u91CD\u65B0\u5617\u8A66\u4E2D")}return o("\u5E33\u865F\u767B\u5165\u7A0B\u5E8F\u5DF2\u5B8C\u6210"),{success:c}};async function x(t,e,r,o){if(await t.$("[name=twoStepAuth][required]")){if(o("\u6709\u555F\u7528 2FA"),!e.twofa)throw new Error("\u672A\u63D0\u4F9B 2FA \u7A2E\u5B50\u78BC");let c=g.authenticator.generate(e.twofa);await t.type("[name=twoStepAuth]",c,{delay:10}).catch(r);return}else{o("\u6C92\u6709\u555F\u7528 2FA");return}}var M=w;module.exports=v(b);0&&(module.exports={});
