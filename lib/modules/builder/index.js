/* minified */
"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const _module_1=__importDefault(require("../_module")),builder=new _module_1.default;function replace(e){var t=time(),a=[[/\$time\$/g,"$year$/$month$/$day$ $hour$:$minute$:$second$"],[/\$year\$/g,t[0]],[/\$month\$/g,t[1]],[/\$day\$/g,t[2]],[/\$hour\$/g,t[3]],[/\$minute\$/g,t[4]],[/\$second\$/g,t[5]]];for(let t=0;t<a.length;t++)e=e.replace(a[t][0],a[t][1]);return e}function time(){const t=(new Date).toLocaleString("en",{timeZone:"Asia/Taipei"}).split(", ");var[e,a,o]=t[0].split("/");let[r,i,u]=t[1].match(/\d{1,2}/g);return 12==+r&&t[1].toLowerCase().includes("am")&&(r=String(+r-12)),+r<12&&t[1].toLowerCase().includes("pm")&&(r=String(+r+12)),[o,e,a,r,i,u]}builder.parameters=[{name:"builder",required:!0,example:[{bsn:"",snA:"",content:""}]}],builder.run=async({page:e,outputs:t,params:a,logger:o})=>{var r=(...t)=>o.log("[95m[回文][m",...t);if(!t.login||!t.login.success)throw new Error("使用者未登入，無法發佈勇者大聲說");var i,u=a["builder"];if(u.length<1)return{success:!1};for(let t=0;t<u.length;t++)try{var{bsn:n,snA:l,content:s}=u[t];r(`正嘗試在 https://forum.gamer.com.tw/C.php?bsn=${n}&snA=${l} 回文`),await e.goto(`https://forum.gamer.com.tw/post1.php?bsn=${n}&snA=${l}&type=2`),await e.waitForTimeout(2e3),await e.$("dialog")&&await e.click("dialog button"),await e.waitForTimeout(300),await e.evaluate(()=>{onTipsClick&&onTipsClick()}),await e.waitForTimeout(300),await e.evaluate(()=>{"none"===document.querySelector("#source").style.display&&bahaRte.toolbar.alternateView(!0)}),await e.waitForTimeout(300),await e.$eval("#source",t=>{t.value=""}),await e.type("#source",replace(s),{delay:11}),await e.waitForTimeout(300),await e.evaluate(()=>{Forum.Post.post()}),await e.waitForTimeout(300),await e.click("form[method=dialog] button[type=submit]"),await e.waitForTimeout(5e3),r(`已在 https://forum.gamer.com.tw/C.php?bsn=${n}&snA=${l} 回文`),t+1<u.length&&(r("等待發文冷卻 1 分鐘"),await e.waitForTimeout(6e4))}catch(t){i=[t],o.error("[95m[回文][m",...i)}return{success:!0}},exports.default=builder;