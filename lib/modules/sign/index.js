var F=Object.create;var s=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var f=a=>s(a,"__esModule",{value:!0});var A=(a,t)=>{for(var n in t)s(a,n,{get:t[n],enumerable:!0})},y=(a,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of T(t))!v.call(a,e)&&(n||e!=="default")&&s(a,e,{get:()=>t[e],enumerable:!(o=M(t,e))||o.enumerable});return a},L=(a,t)=>y(f(s(a!=null?F(k(a)):{},"default",!t&&a&&a.__esModule?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a),S=(a=>(t,n)=>a&&a.get(t)||(n=y(f({}),t,1),a&&a.set(t,n),n))(typeof WeakMap!="undefined"?new WeakMap:0);var j={};A(j,{default:()=>E});var h=L(require("countapi-js"));var w=class{parameters=[];run({page:t,outputs:n,params:o,logger:e}){throw new Error("Module not implemented.")}};var d=new w;d.parameters=[{name:"sign_double_max_attempts",required:!1}];d.run=async({page:a,outputs:t,params:n,logger:o})=>{let e=(...r)=>o.log("[95m[\u7C3D\u5230][m",...r),I=(...r)=>o.warn("[95m[\u7C3D\u5230][m",...r),m=(...r)=>o.error("[95m[\u7C3D\u5230][m",...r);if(!t.login||!t.login.success)throw new Error("\u4F7F\u7528\u8005\u672A\u767B\u5165\uFF0C\u7121\u6CD5\u7C3D\u5230");e("\u958B\u59CB\u57F7\u884C"),await a.goto("https://www.gamer.com.tw/"),await a.waitForTimeout(2e3);let{days:P,finishedAd:u,signin:b}=await c(a),_=b;if(e(`\u5DF2\u9023\u7E8C\u7C3D\u5230\u5929\u6578: ${P}`),b?e("\u4ECA\u65E5\u5DF2\u7C3D\u5230 [92m\u2714[m"):(e("\u4ECA\u65E5\u5C1A\u672A\u7C3D\u5230 [91m\u2718[m"),e("\u6B63\u5728\u5617\u8A66\u7C3D\u5230"),await a.click("a#signin-btn").catch(m),await a.waitForTimeout(5e3),e("\u6210\u529F\u7C3D\u5230 [92m\u2714[m")),t.ad_handler){let r=+n.sign_double_max_attempts||3;for(let l=0;l<r;l++)try{if(e("\u6B63\u5728\u6AA2\u6E2C\u96D9\u500D\u7C3D\u5230\u734E\u52F5\u72C0\u614B"),await a.goto("https://www.gamer.com.tw/"),await a.waitForSelector("a#signin-btn"),await a.waitForTimeout(100),await a.click("a#signin-btn"),await a.waitForSelector("a.popoup-ctrl-btn"),await a.waitForTimeout(100),u){e("\u5DF2\u7372\u5F97\u96D9\u500D\u7C3D\u5230\u734E\u52F5 [92m\u2714[m");break}else{e("\u5C1A\u672A\u7372\u5F97\u96D9\u500D\u7C3D\u5230\u734E\u52F5 [91m\u2718[m"),e("\u5617\u8A66\u89C0\u770B\u5EE3\u544A\u4EE5\u7372\u5F97\u96D9\u500D\u734E\u52F5\uFF0C\u53EF\u80FD\u9700\u8981\u591A\u9054 1 \u5206\u9418"),await a.click("a.popoup-ctrl-btn"),await a.waitForSelector("button[type=submit]"),await a.waitForTimeout(100),await a.click("button[type=submit]"),await a.waitForTimeout(3e3),await a.waitForSelector("ins iframe");let x=await(await a.$("ins iframe")).contentFrame();if(await t.ad_handler({ad_frame:x}),u=(await c(a)).finishedAd,u){e("\u5DF2\u89C0\u770B\u96D9\u500D\u734E\u52F5\u5EE3\u544A [92m\u2714[m");break}throw new Error("\u89C0\u770B\u96D9\u500D\u734E\u52F5\u5EE3\u544A\u904E\u7A0B\u767C\u751F\u672A\u77E5\u932F\u8AA4")}}catch(g){m(g),m(`\u89C0\u770B\u96D9\u500D\u734E\u52F5\u5EE3\u544A\u904E\u7A0B\u767C\u751F\u932F\u8AA4\uFF0C\u5C07\u518D\u91CD\u8A66 ${r-l-1} \u6B21 [91m\u2718[m`)}}else I("\u96D9\u500D\u7C3D\u5230\u734E\u52F5\u9700\u4F7F\u7528 ad_handler \u6A21\u7D44");let i=await c(a);return e("\u57F7\u884C\u5B8C\u7562 \u2728"),!_&&i.signin&&h.default.update("Bahamut-Automation","sign",1),{signed:!!i.signin,doubled:!!i.finishedAd,days:i.days,report:$}};async function c(a){let{data:t}=await a.evaluate(async()=>{let n=new AbortController;return setTimeout(()=>n.abort(),3e4),(await fetch("https://www.gamer.com.tw/ajax/signin.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=2",signal:n.signal})).json()});return t}function $({days:a,signed:t,doubled:n}){let o=`# \u7C3D\u5230

`;return o+=`\u2728\u2728\u2728 \u5DF2\u9023\u7E8C\u7C3D\u5230 ${a} \u5929 \u2728\u2728\u2728
`,t?o+=`\u{1F7E2} \u4ECA\u65E5\u5DF2\u7C3D\u5230
`:o+=`\u274C \u4ECA\u65E5\u5C1A\u672A\u7C3D\u5230
`,n?o+=`\u{1F7E2} \u5DF2\u7372\u5F97\u96D9\u500D\u7C3D\u5230\u734E\u52F5
`:o+=`\u274C \u5C1A\u672A\u7372\u5F97\u96D9\u500D\u7C3D\u5230\u734E\u52F5
`,o+=`
`,o}var E=d;module.exports=S(j);0&&(module.exports={});
