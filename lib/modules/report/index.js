/* minified */
"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const html_to_text_1=require("html-to-text"),_module_1=__importDefault(require("../_module")),md=require("markdown-it")(),td=new(require("turndown"))({headingStyle:"atx"}),DEFAULT_CONFIG={title:"Â∑¥ÂìàËá™ÂãïÂåñÔºÅ Â†±Âëä $time$",ignore:["login","logout","report"]},report=new _module_1.default;async function text(t,e){var e=(await normalize(t,e))["html"];return(0,html_to_text_1.convert)(e).replace(/\n\n\n+/g,"\n\n")}async function markdown(t,e){var e=(await normalize(t,e))["markdown"];return e}async function html(t,e){var e=(await normalize(t,e))["html"];return e}async function normalize(t,e){let r="";r+=`# ${e.title}

`;for(const o in t)if(!e.ignore.includes(o)&&t[o]&&t[o].report){r+=`## ${o}
`;const i=t[o].report;"string"==typeof i?r+=i+"\n":"function"==typeof i&&(r+=await i(JSON.parse(JSON.stringify(t[o])))+"\n")}var n=replace(r),n=md.render(n,{html:!0,linkify:!0,typographer:!0});return{html:n,markdown:td.turndown(n)}}function replace(e){var t=time(),r=[[/\$time\$/g,"$year$/$month$/$day$ $hour$:$minute$:$second$"],[/\$year\$/g,t[0]],[/\$month\$/g,t[1]],[/\$day\$/g,t[2]],[/\$hour\$/g,t[3]],[/\$minute\$/g,t[4]],[/\$second\$/g,t[5]]];for(let t=0;t<r.length;t++)e=e.replace(r[t][0],r[t][1]);return e}function time(){const t=(new Date).toLocaleString("en",{timeZone:"Asia/Taipei"}).split(", ");var[e,r,n]=t[0].split("/");let[o,i,a]=t[1].match(/\d{1,2}/g);return 12==+o&&t[1].toLowerCase().includes("am")&&(o=String(+o-12)),+o<12&&t[1].toLowerCase().includes("pm")&&(o=String(+o+12)),[n,e,r,o,i,a]}report.parameters=[{name:"report_title",required:!1},{name:"report_ignore",required:!1}],report.run=async({params:t,outputs:e,logger:r})=>{const n=Object.assign({},DEFAULT_CONFIG,JSON.parse(JSON.stringify(t)));return"string"==typeof n.ignore&&(n.ignore=n.ignore.split(",")),r.log("[95m[Â†±Âëä][m","DONE"),{text:()=>text(e,n),markdown:()=>markdown(e,n),html:()=>html(e,n),title:replace(n.title)}},exports.default=report;