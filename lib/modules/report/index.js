var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var w=n=>g(n,"__esModule",{value:!0});var I=(n,e)=>{for(var r in e)g(n,r,{get:e[r],enumerable:!0})},_=(n,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of $(e))!h.call(n,t)&&(r||t!=="default")&&g(n,t,{get:()=>e[t],enumerable:!(o=y(e,t))||o.enumerable});return n};var x=(n=>(e,r)=>n&&n.get(e)||(r=_(w({}),e,1),n&&n.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var q={};I(q,{default:()=>k});var f=require("html-to-text");var d=class{parameters=[];run({page:e,outputs:r,params:o,logger:t}){throw new Error("Module not implemented.")}},c=d;var P=require("markdown-it")(),M=new(require("turndown"))({headingStyle:"atx"}),C={title:"\u5DF4\u54C8\u81EA\u52D5\u5316\uFF01 \u5831\u544A $time$",ignore:["login","logout","report"],only_failed:!1},s=new c;s.parameters=[{name:"report_title",required:!1},{name:"report_ignore",required:!1},{name:"only_failed",required:!1}];s.run=async({params:n,outputs:e,logger:r})=>{let o=(...i)=>r.log("\x1B[95m[\u5831\u544A]\x1B[m",...i),t=Object.assign({},C,JSON.parse(JSON.stringify(n)));return typeof t.ignore=="string"&&(t.ignore=t.ignore.split(",")),o("DONE"),{text:()=>L(e,t),markdown:()=>S(e,t),html:()=>b(e,t),title:p(t.title)}};async function L(n,e){let{html:r}=await m(n,e),o=(0,f.convert)(r).replace(/\n\n\n+/g,`

`);return e.only_failed&&!o.includes("\u274C")?"":o}async function S(n,e){let{markdown:r}=await m(n,e);return e.only_failed&&!r.includes("\u274C")?"":r}async function b(n,e){let{html:r}=await m(n,e);return e.only_failed&&!r.includes("\u274C")?"":r}async function m(n,e){let r="";r+=`# ${e.title}

`;for(let a in n){if(e.ignore.includes(a)||!n[a]||!n[a].report)continue;r+=`## ${a}
`;let l=n[a].report;typeof l=="string"?r+=l+`
`:typeof l=="function"&&(r+=await l(JSON.parse(JSON.stringify(n[a])))+`
`)}let o=p(r),t=P.render(o,{html:!0,linkify:!0,typographer:!0}),i=M.turndown(t);return{html:t,markdown:i}}function p(n){let e=O(),r=[[/\$time\$/g,"$year$/$month$/$day$ $hour$:$minute$:$second$"],[/\$year\$/g,e[0]],[/\$month\$/g,e[1]],[/\$day\$/g,e[2]],[/\$hour\$/g,e[3]],[/\$minute\$/g,e[4]],[/\$second\$/g,e[5]]];for(let o=0;o<r.length;o++)n=n.replace(r[o][0],r[o][1]);return n}function O(){let n=new Date().toLocaleString("en",{timeZone:"Asia/Taipei"}).split(", "),[e,r,o]=n[0].split("/"),[t,i,a]=n[1].match(/\d{1,2}/g);return+t==12&&n[1].toLowerCase().includes("am")&&(t=String(+t-12)),+t<12&&n[1].toLowerCase().includes("pm")&&(t=String(+t+12)),[o,e,r,t,i,a]}var k=s;module.exports=x(q);0&&(module.exports={});
