/* minified */
"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const _module_1=__importDefault(require("../_module")),sayloud=new _module_1.default;function replace(t){var e=time(),o=[[/\$time\$/g,"$year$/$month$/$day$ $hour$:$minute$:$second$"],[/\$year\$/g,e[0]],[/\$month\$/g,e[1]],[/\$day\$/g,e[2]],[/\$hour\$/g,e[3]],[/\$minute\$/g,e[4]],[/\$second\$/g,e[5]]];for(let e=0;e<o.length;e++)t=t.replace(o[e][0],o[e][1]);return t}function time(){const e=(new Date).toLocaleString("en",{timeZone:"Asia/Taipei"}).split(", ");var[t,o,r]=e[0].split("/");let[a,n,l]=e[1].match(/\d{1,2}/g);return 12==+a&&e[1].toLowerCase().includes("am")&&(a=String(+a-12)),+a<12&&e[1].toLowerCase().includes("pm")&&(a=String(+a+12)),[r,t,o,a,n,l]}sayloud.parameters=[{name:"sayloud",required:!0,example:[{to:"All Users",text:"Hello World!"}]}],sayloud.run=async({page:e,outputs:t,params:o,logger:r})=>{if(!t.login||!t.login.success)throw new Error("使用者未登入，無法發佈勇者大聲說");t=o.sayloud;if(t.length<1)return{success:!1};await e.goto("https://home.gamer.com.tw/homeindex.php");var o=t[Math.floor(Math.random()*t.length)],t=replace(o.to),o=replace(o.text),t=await e.evaluate(async({to:e,text:t})=>{const o=await fetch("https://home.gamer.com.tw/ajax/sayloud1.php?re=0",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:null}).then(e=>e.text());if(o.includes("目前仍有大聲說在放送"))return 2;const r=document.createElement("div");r.innerHTML=o;var a=r.querySelector("[name=token]").value;return await fetch("https://home.gamer.com.tw/ajax/sayloud2.php",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:`idType=2&uid=&nick=${e}&token=${a}&content=`+encodeURIComponent(t)}).then(e=>e.text())},{to:t,text:o});return 2===t?(r.warn("[95m[勇者大聲說][m","目前仍有大聲說在放送"),{success:!1,reason:"目前仍有大聲說在放送",report:"勇者大聲說： 發送失敗 "}):(o=["放送成功 時間："+t],r.log("[95m[勇者大聲說][m",...o),{success:!0,time:t,report:"勇者大聲說： 發送成功 "+t})},exports.default=sayloud;