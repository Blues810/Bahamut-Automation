/* minified */
function replace(t){var e=time(),o=[[/\$time\$/g,"$year$/$month$/$day$ $hour$:$minute$:$second$"],[/\$year\$/g,e[0]],[/\$month\$/g,e[1]],[/\$day\$/g,e[2]],[/\$hour\$/g,e[3]],[/\$minute\$/g,e[4]],[/\$second\$/g,e[5]]];for(let e=0;e<o.length;e++)t=t.replace(o[e][0],o[e][1]);return t}function time(){const e=(new Date).toLocaleString("en",{timeZone:"Asia/Taipei"}).split(", ");var[t,o,r]=e[0].split("/");let[n,a,s]=e[1].match(/\d{1,2}/g);return 12==+n&&e[1].toLowerCase().includes("am")&&(n=String(+n-12)),+n<12&&e[1].toLowerCase().includes("pm")&&(n=String(+n+12)),[r,t,o,n,a,s]}exports.parameters=[{name:"sayloud",required:!0,example:[{to:"All Users",text:"Hello World!"}]}],exports.run=async({page:e,outputs:t,params:o,logger:r})=>{if(!t.login||!t.login.success)throw new Error("使用者未登入，無法發佈勇者大聲說");var t=o["sayloud"];if(t.length<1)return{success:!1};await e.goto("https://home.gamer.com.tw/homeindex.php");var n,o=t[Math.floor(Math.random()*t.length)],t=replace(o.to),o=replace(o.text),o=await e.evaluate(async({to:e,text:t})=>{const o=await fetch("https://home.gamer.com.tw/ajax/sayloud1.php?re=0",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:null}).then(e=>e.text());if(o.includes("目前仍有大聲說在放送"))return 2;const r=document.createElement("div");r.innerHTML=o;var n=r.querySelector("[name=token]").value;return await fetch("https://home.gamer.com.tw/ajax/sayloud2.php",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:`idType=2&uid=&nick=${e}&token=${n}&content=`+encodeURIComponent(t)}).then(e=>e.text())},{to:t,text:o});return 2===o?(r.warn("[95m[勇者大聲說][m","目前仍有大聲說在放送"),{success:!1,reason:"目前仍有大聲說在放送",report:"勇者大聲說： 發送失敗 "}):(n=["放送成功 時間："+o],r.log("[95m[勇者大聲說][m",...n),{success:!0,time:o,report:"勇者大聲說： 發送成功 "+o})};