var k=Object.create;var m=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var g=e=>m(e,"__esModule",{value:!0});var $=(e,t)=>{for(var o in t)m(e,o,{get:t[o],enumerable:!0})},f=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of x(t))!R.call(e,a)&&(o||a!=="default")&&m(e,a,{get:()=>t[a],enumerable:!(s=y(t,a))||s.enumerable});return e},C=(e,t)=>f(g(m(e!=null?k(_(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),E=(e=>(t,o)=>e&&e.get(t)||(o=f(g({}),t,1),e&&e.set(t,o),o))(typeof WeakMap!="undefined"?new WeakMap:0);var q={};$(q,{default:()=>U});var h=C(require("node-fetch")),A=require("otplib"),I=[{name:"username",required:!0},{name:"password",required:!0},{name:"twofa",required:!1},{name:"login_max_attempts",required:!1}],U={parameters:I,run:async({page:e,params:t,logger:o})=>{let s=(...r)=>o.log("\x1B[95m[login v2]\x1B[m",...r),a=(...r)=>o.error("\x1B[95m[login v2]\x1B[m",...r),i={};s("Login v2 started");let c="",u="",b=+t.login_max_attempts||3;for(let r=0;r<b;r++){let w=t.twofa&&t.twofa.length!=0?`&twoStepAuth=${A.authenticator.generate(t.twofa)}`:"",d=`uid=${encodeURIComponent(t.username)}&passwd=${encodeURIComponent(t.password)}&vcode=6666${w}`;try{let n=await(0,h.default)("https://api.gamer.com.tw/mobile_app/user/v3/do_login.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Cookie:"ckAPP_VCODE=6666"},body:d}),l=await n.json();if(l.userid){let p=n.headers.get("set-cookie");c=p.split(/(BAHARUNE=\w+)/)[1].split("=")[1],u=p.split(/(BAHAENUR=\w+)/)[1].split("=")[1],s("\u2705\u767B\u5165\u6210\u529F");break}else i=l.message}catch(n){a(n),i.error=n}a("\u274C\u767B\u5165\u5931\u6557: ",i.error),await e.waitForTimeout(1e3)}return c!==""&&u!==""?(await e.goto("https://www.gamer.com.tw/"),await e.context().addInitScript(([w,d,n])=>{document.cookie=`BAHAID=${w}; path=/; domain=.gamer.com.tw`,document.cookie=`BAHARUNE=${d}; path=/; domain=.gamer.com.tw`,document.cookie=`BAHAENUR=${n}; path=/; domain=.gamer.com.tw`},[t.username,c,u]),await e.goto("https://www.gamer.com.tw/"),await e.waitForTimeout(1e3),s("\u2705\u767B\u5165 Cookie \u5DF2\u8F09\u5165"),i.success=!0):i.success=!1,i}};module.exports=E(q);0&&(module.exports={});
