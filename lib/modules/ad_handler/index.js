var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var h=e=>i(e,"__esModule",{value:!0});var v=(e,o)=>{for(var t in o)i(e,t,{get:o[t],enumerable:!0})},P=(e,o,t,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of w(o))!y.call(e,r)&&(t||r!=="default")&&i(e,r,{get:()=>o[r],enumerable:!(a=p(o,r))||a.enumerable});return e};var b=(e=>(o,t)=>e&&e.get(o)||(t=P(h({}),o,1),e&&e.set(o,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var k={};v(k,{default:()=>f});var u=class{parameters=[];run({page:o,outputs:t,params:a,logger:r}){throw new Error("Module not implemented.")}},l=u;var g=new l,n=(...e)=>{},m=(...e)=>{};g.run=async function({logger:e}){return n=(...o)=>e.log("\x1B[95m[AD Handler]\x1B[m",...o),m=(...o)=>e.error("\x1B[95m[AD Handler]\x1B[m",...o),n("\u5DF2\u8A2D\u5B9A Google AD \u8655\u7406\u7A0B\u5F0F"),I};async function I({ad_frame:e,timeout:o=60,log:t=n,error:a=m}){t("Google AD \u8655\u7406\u7A0B\u5F0F: Start");let r=await Promise.race([T(o*1e3,"timed out"),(async()=>{try{if(await e.waitForTimeout(1e3),await e.$(".rewardDialogueWrapper:not([style*=none]) .rewardResumebutton")&&await e.click(".rewardDialogueWrapper:not([style*=none]) .rewardResumebutton"),await Promise.race([e.waitForSelector(".videoAdUiSkipContainer.html5-stop-propagation > button",{timeout:35e3}),M(e),d(e)]).catch(()=>{}),await e.waitForTimeout(1e3),await e.$(".videoAdUiSkipContainer.html5-stop-propagation > button"))await e.click(".videoAdUiSkipContainer.html5-stop-propagation > button");else if(await e.$("div#close_button_icon"))await e.click("div#close_button_icon");else if(await e.$("#google-rewarded-video > img:nth-child(4)"))await e.click("#google-rewarded-video > img:nth-child(4)");else if(!await d(e))throw new Error("\u767C\u73FE\u672A\u77E5\u985E\u578B\u7684\u5EE3\u544A");await e.waitForTimeout(2e3)}catch(c){a(c)}})()]);t(r==="timed out"?"Google AD \u8655\u7406\u7A0B\u5F0F: Timed Out":"Google AD \u8655\u7406\u7A0B\u5F0F: Finished")}async function d(e){let o=await e.waitForSelector("video");return await o.evaluate(t=>t.ended)?!0:o.evaluate(t=>new Promise(a=>t.addEventListener("ended",()=>a(!0))))}function M(e){return new Promise(async o=>{try{let t=await e.$("#count_down");if(t){let a=+(await t.evaluate(r=>r.innerText)).replace(/[^0-9]/g,"");setTimeout(o,(a+1)*1e3)}else setTimeout(o,35*1e3)}catch{setTimeout(o,35*1e3)}})}function T(e=1e3,o){return new Promise(t=>setTimeout(()=>t(o),e))}var f=g;module.exports=b(k);0&&(module.exports={});
